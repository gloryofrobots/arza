from fiber import (coroutine)
import affirm

fun test () ->
    co =
        coroutine lam yield x ->
                       _co1 =
                            coroutine lam yield2 y ->
                                           fun send () ->
                                                yield2 (42 + y)

                                           send ()

                       affirm:is_equal x 23
                       x1 = yield (_co1 x)
                       affirm:is_equal x1 34
                       x2 = yield x1
                       affirm:is_equal x2 44
                       x2

    affirm:is_equal (co 23) 65
    affirm:is_equal (co 34) 34
    affirm:is_equal (co 44) 44
