import obin:lang:_api
import obin:lang:_datatype
import seq

type CoreMixin
extend CoreMixin
    with Eq
        def == self other -> _api:equal other self
    with Str
        def str self -> _api:to_string self
    with Repr
        def repr self -> _api:to_repr self
    with Collection
        def put key value self -> _api:put key value self
        def at key self -> _api:at key self
        def del key self -> _api:del key self
        def elem key self -> _api:elem key self
    with Sized
        def len self -> _api:length self
        def is_empty self -> _api:is_empty self

extend Datatype
    with Eq = CoreMixin
    with Str = CoreMixin
    with Repr = CoreMixin

extend Union
    with Seqable
        def to_seq self -> _datatype:union_to_list self
    with Eq = CoreMixin
    with Collection = CoreMixin
    with Sized = CoreMixin

type UnionMixin
extend UnionMixin
    with Rangeable
        def range _from  _to  ->
            union = _datatype:get_union _from
            if not (kindof _to union) ->
                throw ValueError("Invalid type for second argument", _to)
            else ->
                s1 = seq:drop_while (`!=` _from) (to_seq union)
                seq:take_while (`!=` _to) s1
        def range_by _from _to _by ->
            throw NotImplementedError ("Only range from Rangeable is supported")
        def range_from _from ->
            throw NotImplementedError ("Only range from Rangeable is supported")
        def range_from_by _from _step ->
            throw NotImplementedError ("Only range from Rangeable is supported")

