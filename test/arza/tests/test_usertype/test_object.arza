import io
import affirm

type Object(data)

fun new(data) =
    Object(data)

def at(key, obj of Object ) =
    let
        slot = __at__(#data, obj).[key]
    in
        match slot
            | method of Function =
                fun (...args) = method(...prepend(obj, args))
            | _ = slot

fun test() =
    let
        o = new({
            f = (fun(self, x) =
                self.get_x() + x
            ),
            get_x = (self) -> self.x,
            x = 24
        })
    in
        affirm:is_equal(o.f(24), 48)

