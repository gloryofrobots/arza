import io
import affirm
import seq
import list
import array
import string
import process
//import tests
//import tests:test_process


fun coro(args, fn) =
    let
        proc1 = self()
        proc2 = process:create()

        fun chan1(val) =
            proc2 ! val
            receive msg = msg

        fun chan2(val) =
            proc1 ! val
            receive msg = msg

    in
        process:start(proc2, fn, args ++ chan2)
        chan1

fun main() =
    let
        c = coro((fun(a, yield) =
            yield(a)
            yield(1)
            yield(2)
        ))
    in
        io:print .. c(42)
        io:print .. c(43)
    ()
//    test_process:test()
//    test_simple()
//    tests:run()
