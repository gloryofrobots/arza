from arza:lang:_process  import _

fun wait_while_working(pid) =
    if is_finished(pid) then True
    elif is_waiting(pid) then False
    else wait_while_working(pid)

fun wait_for(procs of List) =
    let
        fun _loop(_procs, _results)
            | ([], results) =
//                PL(">>finished", results, _procs)
                results
            | (tl::hd, results) =
//                PL(">>working", results, _procs)
//                PL(tl, is_finished(tl))
                if is_finished(tl) then
                    let
                        res = result(tl)
                    in
//                        PL(">>proc end", results, hd)
                        _loop(hd, results.{(tl) = res})
                else
                    _loop(procs, results)
    in _loop(procs, {})


