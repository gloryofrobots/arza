<html>
<head>
<title>Obin parser prototype</title>
    <meta charset="utf-8" />
     <script src = 'underscore.js'></script>
    <script src = 'jquery.js'></script>
    <script src = 'tokens.js'></script>
    <script src = 'parse.js'></script>
     <script src = 'transform.js'></script>
   
    <style type="text/css">
        #program {
             width:28%;
             height:500px;
             float:left;       
        }
        #result {
             width:68%;
             height:1024px;
             float:right;       
        }
    </style>
</head>
<script type="text/template" id="program-body">
    // fn floor(x,y,z) {

    // }

    // floor = fn ceil(t,y,u::g) {

    // } + 2;

    // t = do {
    //     1 + 3 + 4;
    // }

    // if x > 10 {
    //     print(x,30);
    // } elif x < 20 {
    //     print("less");
    // } else {
    //     print("unknown");
    // }

    while z {
        print(z);
    }

    for x,y,t in data {
        print(x + y);
    }
    // floor = fn ceil(t,y,u::g) {

    // }(2,3) + 2;

    //1,2,3,4
    //1,(2,3),4


    // cell Z
    //     self.isa(Origin)

    //     x = 2
    //     y = 3

    //     self.l = 2
    //     self.s = 345
    //     pmax = fun() {
    //         x if x > y else y
    //     }
        
    //     fun max() 
    //         pmax()
    //     end
    // end
    // fun maximize(x, y, z)
    //     x + y - z
    // end

    // 1,2, x, r, t, y

    // v = 1 - 
    // 2

    // z = if x == 1 then 5; else 6; end 

    // if x==1
    //     x = 112
    // elif x == 2 then x = 345; t += 34; z = 234 + 56 * 67 - 4456;
    // else 
    //     x = 14
    // end + 3


    // x = 1 + 2
    // y = 2 + 3
    
    // // x = 112 if x == 1 else 14;

</script>
<body>
    <script>
    function compile() {
        var ptext = $("#program").val();
        //console.log("ptext:", ptext);
        var parser = make_parse();
        var ast = parser(ptext);
        
        //console.log(ast);
        var output = JSON.stringify(ast,
            function(key, value) {
                if(key  == "scope" || key == "from" || key == "to" || key == "arity") {
                    return undefined;
                } 
                else {
                    return value;
                }
            }, 2);
        //console.log("ast:", output );
        $("#result").html(output); 

        /*var ast = transform(ast);
        var output = JSON.stringify(ast,
            function(key, value) {
                if(key  == "scope" || key == "from" || key == "to" || key == "arity") {
                    return undefined;
                } 
                else {
                    return value;
                }
            }, 2);*/
        //$("#result").html(output); 

    }
    </script>
    <button onclick="compile()">Compile</button><br/><br/>

    <textarea id="program"> var x =  1 + 2 * 3; </textarea> 

    
    
    <textarea id="result"></textarea>
    <script type="text/javascript">
        $(document).ready(function(){
             $("#program").val($("#program-body").html());
            compile();
        });
           
    </script>
</body>
</html>