def assert_equal_batch(fn, ...calls) ->
    _batch(assert_equal, fn, calls);

def _batch(checker, fn, calls) ->
    for call in calls
        checker(apply(fn, call[0]), call[1])
    ;;

def fail(error) ->
    throw error;

def assert_equal(val1, val2) ->
    if val1 != val2
        fail([val1, "!=", val2])
    else
        true
    ;;

def assert_is(val1, val2) ->
    if val1 isnot val2
        fail([val1, "isnot", val2])
    else
        true
    ;;


def assert_true(val1) ->
    assert_is(val1, true);

def assert_false(val1) ->
    assert_is(val1, false);


def assert_throw(fn, args) ->
    try
        apply(fn, args)
        fail(["exception expected", fn])
    catch e
        e
    ;;

def assert_throw_expected(fn, args, exc) ->
    assert_equal(assert_throw(fn, args), exc);
