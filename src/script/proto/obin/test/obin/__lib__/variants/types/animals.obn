trait Animal {health}
trait HealthyShark
trait DyingShark

record Shark {health, speed, power}
| speed power health
| {speed, power, health}
| speed power -> health = 100
| {speed, power} -> health = 100
| (speed, power) -> health = 100
| speed -> power = 100; health = 100
| () -> speed=100; power=100; health = 100
isa Animal, HealthyShark
------------------------------------

Shark 130 200
Shark {speed=130, power=200}

record Fish speed
| speed
| () -> speed = 90
isa Animal
------------

generic encounter
| self of Fish, a of Animal -> ...
| self of Fish, s of HealthyShark -> swimAway f
| self of HealthyShark, o of Fish -> swallow self o
| self of DyingShark, o of Animal -> swimAway s
-----------------------------------------

generic swallow
| s of Shark, o of Fish -> ...
---------------------------

generic fight
| s of HealthyShark, o of Shark -> s nota HealthyShark isa DyingShark end

generic swimAway
| a of Animal -> ...
------------------------

//////////////////////////////////////////////////

trait Animal
| encounter _ a
---------------

trait Predator
| fight _ a
| swallow _ a
---------------------

trait WaterAnimal
| swimAway _
--------------------

type Shark {health, speed, power}
| speed power health
| {speed, power, health}
| speed power -> health = 100
| {speed, power} -> health = 100
| (speed, power) -> health = 100
| speed -> power = 100; health = 100
| () -> speed=100; power=100 health = 100
------------------------------------

type HealthyShark {use Shark}
---------------------------

type DyingShark {use Shark}
---------------------------

type Fish speed
| speed
| () -> speed = 90
------------

implement Animal
for Fish
    specify encounter
    | self, a of Animal -> ...
    | self, s of HealthyShark -> swimAway f
for HealthyShark
    specify encounter
    | self, o of Fish -> swallow self o
    | self, o of Shark -> fight self o
for DyingShark
    specify encounter
    | self, o of Animal -> swimAway s
-----------------------------------------

implement WaterAnimal
for Fish
    specify swimAway self of _ -> ...
for Shark as for Fish
for DyingShark as for Fish
for HealthyShark as for Fish
---------------------------

implement Predator
for Shark
    specify swallow
    | self, o of Fish -> ...
    specify fight
    | self, s of Shark -> ...
for HealthyShark
    specify swallow as for Shark
    specify fight
    | self, o of Shark -> self as DyingShark
--------------------------


